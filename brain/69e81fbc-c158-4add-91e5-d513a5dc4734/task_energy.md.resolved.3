# ⚡ Task Tracker: Hệ Thống Năng Lượng (Hearts) & Subscriptions

- [x] 1. Core Logic ([ProgressService](file:///Users/devsang/Developer/App%20Learn%20English/lib/core/services/progress_service.dart#13-732)):
  - Khai báo state: `currentEnergy` (mặc định 5), `lastEnergyRefillTime`, `isUnlimitedEnergy`.
  - Hàm check / trừ năng lượng: [deductEnergy()](file:///Users/devsang/Developer/App%20Learn%20English/lib/core/services/progress_service.dart#272-287).
  - Logic phục hồi: Timer cộng 1 ⚡ mỗi 20-30 phút. Hoặc tính toán chênh lệch thời gian khi mở lại App.
- [x] 2. UI Hiển thị ([EnergyBadge](file:///Users/devsang/Developer/App%20Learn%20English/lib/presentation/widgets/energy_badge.dart#6-149)):
  - Hiển thị số Năng Lượng ⚡ hiện tại trên Header của [MainWrapper](file:///Users/devsang/Developer/App%20Learn%20English/lib/presentation/screens/main_wrapper.dart#15-259).
  - Đỏ/Xám khi năng lượng = 0 và hiện Countdown Timer tới lúc hồi 1 ⚡.
- [x] 3. Màn hình Cứu Trợ ([OutOfEnergyDialog](file:///Users/devsang/Developer/App%20Learn%20English/lib/presentation/widgets/out_of_energy_dialog.dart#7-208)):
  - Bật lên khi người dùng cố chơi hoặc đang chơi mà mất ⚡ cuối cùng.
  - Option 1: Dùng 100 ⭐️ mua 1 ⚡.
  - Option 2: Mua gói Plus (Unlimited ⚡).
- [ ] 4. Logic Game Loop (Trừ năng lượng):
  - Cài cắm hàm trừ ⚡ vào [learning_controller.dart](file:///Users/devsang/Developer/App%20Learn%20English/lib/presentation/controllers/learning_controller.dart) (Flashcard / Trắc nghiệm).
  - Cài cắm vào [memory_match_controller.dart](file:///Users/devsang/Developer/App%20Learn%20English/lib/presentation/controllers/memory_match_controller.dart) (Lật sai thẻ).
  - Cài cắm vào [listen_find_controller.dart](file:///Users/devsang/Developer/App%20Learn%20English/lib/presentation/controllers/listen_find_controller.dart) (Nghe tìm hình sai).
